package com.blackhammer.stereviewer{		import flash.display.*;	import flash.geom.*;	import flash.media.*;	import flash.events.*;	import flash.text.*;	import fl.motion.*;	import com.blackhammer.stereviewer.*;	import com.blackhammer.util.BHUtils;	import com.greensock.TimelineLite;	import com.greensock.TweenLite;	import com.greensock.easing;			    import flash.text.StyleSheet;	//import com.greensock.OverwriteManager;		public class TextDisplay extends Sprite{				private var _myDaddy:Object;		private var _gSprite:Sprite = new Sprite();		private var _g:Graphics;		private var _fieldW:Number;		private var _fieldH:Number;		public var _displayField:TextField  = new TextField();		private var _format:TextFormat = new TextFormat(); //"Gotham_book"		//private var _displayTween:TweenLite;		private var _inProgress:Boolean;		private var _messageTimeline:TimelineLite;		private var _clickToKill:Boolean = false;		private var _messageID:int; //0:none, 1:instruction, 2:bonus, 3:Starting over		private var _waitForClick:Boolean = false;		private var _margin:int = 20;		private var _saveButton_local = new save_local();		private var _saveButton_file = new save_tofile();		private var _revertButton_local = new revert_local();		private var _revertButton_file = new revert_tofile();		private var _Config:SV_Config;				public function TextDisplay(myDaddy:Object, fieldW:Number, fieldH:Number, margin:Number, centered:Boolean=false):void{			//OverwriteManager.init(OverwriteManager.PREEXISTING);						//Font.registerFont(Comic_embed); //didn't work in CS4, might be CS5.			_myDaddy = myDaddy;			_Config = SV_Config.getInstance();			_inProgress = false			_g = _gSprite.graphics;			addChild(_gSprite);			_fieldW = fieldW;			_fieldH = fieldH;			_margin = margin;			_displayField.multiline = _displayField.wordWrap = true;			_displayField.autoSize = TextFieldAutoSize.CENTER;			_displayField.type = TextFieldType.DYNAMIC;			_displayField.selectable =false;			_displayField.antiAliasType = flash.text.AntiAliasType.ADVANCED;						///use border for placement testing			//_displayField.border = true;			//_displayField.borderColor = 0x990000;						var customFont:Font = new HelveticaNeueRegular();			_format.font = customFont.fontName;			//_format.bold = true;            _format.color = SV_Config.FONTCOLOR; //0xEEEEEE            _format.size = 24;			//_format.letterSpacing = 0;            _format.underline = false;			_format.align = TextFormatAlign.LEFT;			if(centered){				_format.align = TextFormatAlign.CENTER;			}			//_format.leading = SV_Config.LEADING;            _displayField.defaultTextFormat = _format;			//_displayField.htmlText = ".";			_displayField.embedFonts = true;			_gSprite.addChild(_displayField);			//_displayField.rotation = 10; //for testing			//this.visible = false;			//this.alpha = 0.0;			//this.transform.matrix = new Matrix(1, 0, 0, 1,  -_fieldW,  -_fieldH);			//not centering			//this.setRegistrationPoint(this.width >> 1, this.height >> 1, false);			//this.addEventListener(Event.ADDED_TO_STAGE, onTheStage, false, 0, true);		}				private function onTheStage(e:Event):void{			this.removeEventListener(Event.ADDED_TO_STAGE,onTheStage);			//this.alpha = 0.0;			//not centering			//this.x = (stage.stageWidth)/2;			//this.y = (stage.stageHeight)/2;		}				public function mPlay(daText:String,fontSize:Number, readDelay:Number, isbold:Boolean = false, showBacking:Boolean=false, clickToKill:Boolean = false,messageID:int = 0):void{			setUpStuff(showBacking);			_format.size = fontSize;			_format.bold = isbold;			_format.leading = SV_Config.LEADING;			_displayField.htmlText = daText;			_displayField.setTextFormat(_format); //added insted of using default			var textH = _displayField.height;			var textW = _displayField.width;			_displayField.x = (_fieldW - textW)/2 			_displayField.y = _margin; //(_fieldH - textH)/2			_clickToKill = clickToKill;			_messageID = messageID;			if (readDelay == 0) _waitForClick = true;			//this.visible = true;			_inProgress = true;						//no mouse events			//this.addEventListener(MouseEvent.MOUSE_DOWN, OnMouseDown, false, 0, true);			if (SV_Config.EDITMODE){				this.addEventListener(MouseEvent.MOUSE_DOWN, OnMouseDownEdit, false, 0, true);			}			TweenLite.to(_displayField,.7,{alpha:1.0,delay:.1,onComplete:finishPlay});			//var textTween:TweenLite =  new TweenLite(_displayField, .7, {alpha:1.0,delay:.1,onComplete:finishShow});			if(SV_Config.EDITMODE)						showEditButtons();			if(!_waitForClick)						hideText();						}			private function finishPlay():void{				//_myDaddy.MessageDone(_messageID);				_myDaddy.showDone(this);		}				private function finishHide():void{				//this.visible = false;				//this.alpha = 0.0;				_inProgress = false;				_messageTimeline = null;				_myDaddy.hideDone(this);		}				private function showEditButtons():void{			_revertButton_local.x = 0;			_revertButton_local.y = -10;			addChild(_revertButton_local);			_revertButton_local.addEventListener(MouseEvent.MOUSE_DOWN, onRevertButtonLocal, false, 0, true);						_revertButton_file.x = 70;			_revertButton_file.y = -10;			addChild(_revertButton_file);			_revertButton_file.addEventListener(MouseEvent.MOUSE_DOWN, onRevertButtonFile, false, 0, true);						_saveButton_local.x = 140;			_saveButton_local.y = -10;			addChild(_saveButton_local);			_saveButton_local.addEventListener(MouseEvent.MOUSE_DOWN, onSaveButtonLocal, false, 0, true);						_saveButton_file.x = 210;			_saveButton_file.y = -10;			addChild(_saveButton_file);			_saveButton_file.addEventListener(MouseEvent.MOUSE_DOWN, onSaveButtonFile, false, 0, true);		}		private function OnMouseDownEdit(e:Event){			e.stopPropagation();			_displayField.selectable =true;			_displayField.type = TextFieldType.INPUT;			this.removeEventListener(MouseEvent.MOUSE_DOWN, OnMouseDownEdit);		}				private function OnMouseDown(e:Event):void{			e.stopPropagation();			//trace("trapmousedown in OnMouseDown");			if(_inProgress && _clickToKill && !_waitForClick){				//_messageTimeline.complete(); //this is screwing up formatting on next display?			}			if(_waitForClick){				_waitForClick = false;				//trace("trapmousedown in _waitForClick");				hideText();			}			this.removeEventListener(MouseEvent.MOUSE_DOWN, OnMouseDown);		}				private function onRevertButtonLocal(e:Event):void{			e.stopPropagation();			_myDaddy.revertTextFromXML(this);		}		private function onRevertButtonFile(e:Event):void{			e.stopPropagation();			_myDaddy.revertTextFromFile(this);		}		public function updateText(daText:String):void{			_displayField.htmlText = daText;		}		private function onSaveButtonLocal(e:Event):void{			e.stopPropagation();			_myDaddy.saveXMLlocal(this,_displayField.text);		}		private function onSaveButtonFile(e:Event):void{			e.stopPropagation();			_myDaddy.saveXMLtoFile(this,_displayField.text);		}				private function setUpStuff(backIsOn:Boolean):void{			if (backIsOn){				_g.clear();				_g.beginFill(0xEEEEEE,1.0); //(0x333333,0.90)				_g.drawRoundRect(0,0,_fieldW,_fieldH,10);				//not centering				//_gSprite.transform.matrix = new Matrix(1, 0, 0, 1, -_fieldW/2, -_fieldH/2);				addChild(_gSprite);			}			_displayField.alpha = 0			_displayField.width = _fieldW -2*_margin;			_displayField.height = _fieldH - 2*_margin;			//_displayField.transform.matrix = new Matrix(1, 0, 0, 1, -(_displayField.width)/2, -(_displayField.height)/2);			}				public function setRegistrationPoint(regx:Number, regy:Number, showRegistration:Boolean )		{		  //translate movieclip 			 this.transform.matrix = new Matrix(1, 0, 0, 1, -regx, -regy);				 //registration point.		 if (showRegistration)			{				var mark:Sprite = new Sprite();				mark.graphics.lineStyle(1, 0xFF0000);				mark.graphics.moveTo(-5, -5);				mark.graphics.lineTo(5, 5);				mark.graphics.moveTo(-5, 5);				mark.graphics.lineTo(5, -5);				addChild(mark);			}		}				public function changeFontColor(color:uint):void{			_format.color = color;			_displayField.setTextFormat(_format);		}		public function hideText():void{			var tweenOne:TweenLite = new TweenLite(_displayField, .7, {alpha:0.0, onComplete:finishHide})		}		public function mShow():void{			TweenLite.to(_displayField, .4, {alpha:1.0});		}		public function mHide():void{			TweenLite.to(_displayField, .4, {alpha:0.0});			//this.alpha = 0;		}		public function kill():void{			_displayField.htmlText = "";								}			}}